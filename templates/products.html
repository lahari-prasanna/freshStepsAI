<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Product Recommendations ‚Äî FreshSteps AI</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Lobster&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- Animate.css for SweetAlert animations -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <style>
  body{background:#f5f7fa;font-family:Inter,Arial} .card{border-radius:12px}
  #particles-js {
    position:fixed;
    width: 100%;
    height:100%;
    background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
    left: 0;
    z-index: -1;
  }
  .hdr {
    background: linear-gradient(90deg, #4338ca, #6366f1);
    color: #fff;
    padding: 20px;
    border-radius: 12px;
    margin-bottom:30px;
  }
  .hdr h1 {margin: 0;font-weight: 800}
  .card {
    background: rgba(255, 255, 255, 0.12);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border-radius: 16px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
    color: #fff;
    padding: 20px;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  .card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.6);
  }
  .wrap {max-width: 1180px;padding: 16px}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
</head>
<body>
  <div class="container ">
    <div id="particles-js"></div>
    <div class="wrap">
     <header class="hdr card">
      <div style="margin-top:6px;color:white;">
        <h1><span style=" color:#2e88ff; font-family:Lobster;">FreshSteps AI</span> <span style="color:white">‚ÄîProduct Recommendations</span></h1>
      </div>
    </header>

    <!-- üí∞ Coin Balance -->
    <div class="card p-3 mb-4 text-center" style="max-width:300px;margin:auto;background:rgba(255,255,255,0.15);">
      <h5>üí∞ Your Coins</h5>
      <h3 id="coin-balance">{{ info.coins }}</h3>
    </div>
    
    <div class="row">
      {% for r in recommendations %}
        <div class="col-md-4">
          <div class="card p-3 mb-3">
            <div style="height:140px;display:flex;align-items:center;justify-content:center;background:#fff;border-radius:8px">
              <img src="{{ url_for('static', filename=r.image) }}" alt="Product" 
     style="height:150px; width:500px; border-radius:8px;">
            </div>
            <h5 class="mt-2">{{ r.name }}</h5>
            <div style="color:white">{{ r.why }}</div>
            <div class="mt-2"><b>Estimated price:</b> {{ r.est_price }}</div>
            <div class="mt-2"><span class="badge bg-primary">{{ r.tag }}</span></div>
            <a class="btn btn-success mt-3" href="#" role="button">Buy / Details</a>
            <!-- Buy with Coins -->
            <button class="btn btn-warning mt-2 buy-btn"
                    data-submission="{{ submission_id }}"
                    data-price="{{ r.est_price }}">
              Buy with Coins
            </button>
          </div>
        </div>
      {% endfor %}
    </div>
    <div class="insights"></div>
    <a class="btn btn-secondary" href="{{ url_for('dashboard', submission_id=submission_id) }}">‚Üê Back to Dashboard</a>
  </div>

  <script>
     // particles background
    particlesJS("particles-js", {
      "particles": {
        "number": {"value": 110,"density": {"enable": true,"value_area": 1000}},
        "color": {"value": ["#ffffff", "#87ceeb", "#b3e5fc"]},
        "shape": {"type": "circle","stroke": {"width": 0,"color": "#000000"}},
        "opacity": {"value": 0.6,"random": true,"anim": {"enable": true,"speed": 1.2,"opacity_min": 0.3,"sync": false}},
        "size": {"value": 3,"random": true,"anim": {"enable": true,"speed": 2,"size_min": 0.5,"sync": false}},
        "line_linked": {"enable": false},
        "move": {"enable": true,"speed": 2,"random": true,"straight": false,"out_mode": "out"}
      },
      "interactivity": {
        "detect_on": "canvas",
        "events": {"onhover": {"enable": true,"mode": "repulse"},"onclick": {"enable": true,"mode": "push"},"resize": true},
        "modes": {"repulse": {"distance": 100,"duration": 0.4},"push": {"particles_nb": 4}}
      },
      "retina_detect": true
    });

    // üí∞ Buy with Coins script + SweetAlert2 popup animations
    document.querySelectorAll(".buy-btn").forEach(btn => {
      btn.addEventListener("click", async () => {
        const submissionId = btn.dataset.submission;
        const priceStr = btn.dataset.price.replace(/[^0-9]/g, "");
        const price = parseInt(priceStr) || 0;

        const response = await fetch(`/buy_with_coins/${submissionId}`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ price: price })
        });

        const result = await response.json();
        if (result.error) {
          Swal.fire({
            icon: "error",
            title: "Oops!",
            text: result.error,
            showConfirmButton: false,
            timer: 2500,
            showClass: { popup: 'animate__animated animate__shakeX' },
            hideClass: { popup: 'animate__animated animate__fadeOutUp' }
          });
        } else {
          Swal.fire({
            icon: "success",
            title: "Purchase Successful üéâ",
            text: result.message,
            showConfirmButton: false,
            timer: 2500,
            showClass: { popup: 'animate__animated animate__bounceIn' },
            hideClass: { popup: 'animate__animated animate__fadeOutDown' }
          });
          document.getElementById("coin-balance").innerText = result.remaining_coins;
        }
      });
    });
  </script>
</body>
</html>
